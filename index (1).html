<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SuperApp PixelUp ‚Äî Estrutura (v1)</title>
  <meta name="description" content="Estrutura inicial do SuperApp PixelUp ‚Äî PWA responsivo, CRM lista + kanban, export/import, caixas, produtos e √°rea de mentoria (sem Firebase)." />

  <!-- Tailwind CDN (config para paleta PixelUp azul neon) -->
  <script>
    tailwind = window.tailwind || {};
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'pixelup-blue': '#002B6D',
            'pixelup-neon': '#00A8FF',
            'pixelup-accent': '#0AC5FF'
          }
        }
      }
    }
  </script>

  <!-- SortableJS para Kanban drag & drop -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <!-- SheetJS para import de Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- Lucide icons -->
  <script src="https://unpkg.com/lucide@0.266.0/dist/lucide.min.js"></script>

  <style>
    /* Estilos pequenos customizados */
    .neon-btn { background: linear-gradient(90deg, rgba(0,168,255,1) 0%, rgba(10,197,255,1) 100%); }
    .kanban-card { transition: box-shadow .15s ease; }
    .kanban-card:hover { box-shadow: 0 6px 18px rgba(10,197,255,0.12); }
    /* For√ßa mobile-friendly touch targets */
    .touch-target { padding: 0.75rem; }
  </style>
</head>
<body class="bg-[#0b1016] text-white min-h-screen font-sans">
  <div class="max-w-[1300px] mx-auto p-4">
    <!-- Header -->
    <header class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-4">
        <div id="logoPreview" class="w-14 h-14 bg-white/5 rounded-lg flex items-center justify-center text-pixelup-neon font-bold">PU</div>
        <div>
          <h1 class="text-xl font-semibold">SuperApp <span class="text-pixelup-neon">PixelUp</span></h1>
          <p class="text-sm text-white/60">Estrutura inicial ‚Äî sem Firebase (localStorage como fallback)</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <button id="uploadLogoBtn" class="px-3 py-2 neon-btn rounded-md text-black font-medium">Upload logo</button>
        <button id="openChatBtn" class="px-3 py-2 border border-white/10 rounded-md">Abrir Chatbot</button>
      </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <!-- Sidebar nav -->
      <nav class="md:col-span-1 bg-white/3 rounded-lg p-3">
        <ul class="space-y-2 text-sm">
          <li><button class="w-full text-left nav-btn touch-target" data-view="dashboard">üìä Dashboard</button></li>
          <li><button class="w-full text-left nav-btn touch-target" data-view="crm-list">üë• CRM - Lista</button></li>
          <li><button class="w-full text-left nav-btn touch-target" data-view="crm-kanban">üóÇÔ∏è CRM - Kanban</button></li>
          <li><button class="w-full text-left nav-btn touch-target" data-view="import-export">üì• Import/Export</button></li>
          <li><button class="w-full text-left nav-btn touch-target" data-view="caixa">üí∞ Controle de Caixa</button></li>
          <li><button class="w-full text-left nav-btn touch-target" data-view="produtos">üì¶ Produtos & Precifica√ß√£o</button></li>
          <li><button class="w-full text-left nav-btn touch-target" data-view="mentoria">üéì Mentoria</button></li>
        </ul>
      </nav>

      <!-- Main area -->
      <main class="md:col-span-3 space-y-4">
        <!-- Views container -->
        <section id="view-dashboard" class="view bg-white/5 rounded-lg p-4 hidden">
          <h2 class="text-lg font-semibold">Dashboard</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mt-3">
            <div class="p-4 bg-white/3 rounded">Leads totais<br><span id="statTotalLeads" class="text-2xl font-bold">0</span></div>
            <div class="p-4 bg-white/3 rounded">Leads quentes<br><span id="statHot" class="text-2xl font-bold">0</span></div>
            <div class="p-4 bg-white/3 rounded">Saldo caixa<br><span id="statCash" class="text-2xl font-bold">R$ 0,00</span></div>
            <div class="p-4 bg-white/3 rounded">Produtos em estoque<br><span id="statStock" class="text-2xl font-bold">0</span></div>
          </div>
        </section>

        <section id="view-crm-list" class="view bg-white/5 rounded-lg p-4 hidden">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold">CRM ‚Äî Lista</h2>
            <button id="newLeadBtn" class="px-3 py-2 neon-btn rounded">+ Novo Lead</button>
          </div>

          <div class="mt-4">
            <input id="filterSearch" placeholder="Pesquisar por nome, WhatsApp ou origem" class="w-full p-2 rounded bg-black/20" />
            <div id="leadsList" class="mt-3 space-y-2"></div>
          </div>
        </section>

        <section id="view-crm-kanban" class="view bg-white/5 rounded-lg p-4 hidden">
          <h2 class="text-lg font-semibold">CRM ‚Äî Kanban</h2>
          <div class="mt-3 overflow-x-auto">
            <div class="flex gap-4" id="kanbanBoard">
              <!-- Columns rendered by JS -->
            </div>
          </div>
        </section>

        <section id="view-import-export" class="view bg-white/5 rounded-lg p-4 hidden">
          <h2 class="text-lg font-semibold">Import / Export</h2>
          <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="p-4 bg-white/3 rounded">
              <h3 class="font-medium">Importar planilha (Excel)</h3>
              <p class="text-sm text-white/60">Mapeie colunas: Nome, WhatsApp, Origin, Qualification, Description, Status</p>
              <input id="xlsxFile" type="file" accept=".xlsx,.xls" class="mt-2 w-full" />
              <button id="importXlsxBtn" class="mt-2 px-3 py-2 neon-btn rounded">Importar</button>
            </div>
            <div class="p-4 bg-white/3 rounded">
              <h3 class="font-medium">Exportar contatos</h3>
              <label class="text-sm">Per√≠odo:</label>
              <div class="flex gap-2 mt-2">
                <input id="expFrom" type="date" class="p-2 rounded bg-black/20" />
                <input id="expTo" type="date" class="p-2 rounded bg-black/20" />
              </div>
              <button id="exportCsvBtn" class="mt-3 px-3 py-2 neon-btn rounded">Exportar CSV</button>
            </div>
          </div>
        </section>

        <section id="view-caixa" class="view bg-white/5 rounded-lg p-4 hidden">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold">Controle de Caixa</h2>
            <button id="newCashBtn" class="px-3 py-2 neon-btn rounded">+ Lan√ßamento</button>
          </div>
          <div id="cashList" class="mt-4"></div>
        </section>

        <section id="view-produtos" class="view bg-white/5 rounded-lg p-4 hidden">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold">Produtos & Precifica√ß√£o</h2>
            <button id="newProductBtn" class="px-3 py-2 neon-btn rounded">+ Produto</button>
          </div>
          <div id="productsList" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
        </section>

        <section id="view-mentoria" class="view bg-white/5 rounded-lg p-4 hidden">
          <h2 class="text-lg font-semibold">Mentoria ‚Äî PixelUp</h2>
          <p class="text-sm text-white/60 mt-2">Envie o arquivo Word com os m√≥dulos que eu importo pra c√° (pr√≥ximo passo).</p>
          <div id="mentoriaModules" class="mt-4 space-y-3"></div>
        </section>

      </main>
    </div>
  </div>

  <!-- Modal: Lead form -->
  <div id="modal" class="fixed inset-0 bg-black/60 hidden items-center justify-center p-4">
    <div class="bg-[#071022] rounded-lg w-full max-w-xl p-4">
      <h3 id="modalTitle" class="text-lg font-semibold">Novo Lead</h3>
      <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-2">
        <input id="leadName" placeholder="Nome" class="p-2 rounded bg-black/20" />
        <input id="leadWhats" placeholder="WhatsApp (somente n√∫meros)" class="p-2 rounded bg-black/20" />
        <input id="leadOrigin" placeholder="Origem (ex: Instagram)" class="p-2 rounded bg-black/20" />
        <select id="leadQual" class="p-2 rounded bg-black/20">
          <option value="quente">Quente</option>
          <option value="morno">Morno</option>
          <option value="frio">Frio</option>
        </select>
        <textarea id="leadDesc" placeholder="Descri√ß√£o / Observa√ß√µes" class="md:col-span-2 p-2 rounded bg-black/20"></textarea>
      </div>
      <div class="flex justify-end gap-2 mt-3">
        <button id="saveLeadBtn" class="px-3 py-2 neon-btn rounded">Salvar</button>
        <button id="closeModalBtn" class="px-3 py-2 border rounded">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Simple Chatbot Drawer (mock) -->
  <div id="chatDrawer" class="fixed right-4 bottom-4 w-[360px] bg-[#071022] rounded-lg shadow-lg hidden">
    <div class="p-3 border-b border-white/5 flex items-center justify-between">
      <div class="flex items-center gap-2"><span class="w-8 h-8 bg-pixelup-neon/10 rounded flex items-center justify-center text-pixelup-neon">B</span><strong>Bot PixelUp</strong></div>
      <button id="closeChat" class="text-white/60">‚úñ</button>
    </div>
    <div id="chatMessages" class="p-3 h-48 overflow-y-auto text-sm"></div>
    <div class="p-3 flex gap-2">
      <input id="chatInput" class="flex-1 p-2 rounded bg-black/20" placeholder="Escreva uma mensagem..." />
      <button id="sendChat" class="px-3 py-2 neon-btn rounded">Enviar</button>
    </div>
  </div>

  <input id="logoInput" type="file" accept="image/*" class="hidden" />

  <script>
    /* ---------------------- Storage helpers ---------------------- */
    const STORAGE_KEYS = {
      leads: 'pixelup_leads_v1',
      cash: 'pixelup_cash_v1',
      products: 'pixelup_products_v1',
      logo: 'pixelup_logo_v1',
      mentorship: 'pixelup_mentoria_v1'
    };

    function saveData(key, data) { localStorage.setItem(key, JSON.stringify(data || [])); }
    function loadData(key) { try { return JSON.parse(localStorage.getItem(key)) || []; } catch(e){ return []; } }

    /* ---------------------- Initial sample data ---------------------- */
    if (!localStorage.getItem(STORAGE_KEYS.leads)) {
      const sample = [
        { id: genId(), name: 'Jo√£o Silva', whatsapp: '5597999123456', origin: 'Instagram', qualification: 'quente', description: 'Interesse em carro', status: 'novo', createdAt: new Date().toISOString() },
        { id: genId(), name: 'Maria Souza', whatsapp: '5597999987654', origin: 'Indica√ß√£o', qualification: 'morno', description: '', status: 'em-contato', createdAt: new Date().toISOString() }
      ];
      saveData(STORAGE_KEYS.leads, sample);
    }
    if (!localStorage.getItem(STORAGE_KEYS.caixa)) { saveData(STORAGE_KEYS.cash, []); }
    if (!localStorage.getItem(STORAGE_KEYS.products)) { saveData(STORAGE_KEYS.products, []); }

    /* ---------------------- Utils ---------------------- */
    function genId() { return 'id_' + Math.random().toString(36).slice(2,9); }
    function fmtMoney(v){ return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(Number(v)||0); }

    /* ---------------------- Navigation ---------------------- */
    document.querySelectorAll('.nav-btn').forEach(b=>b.addEventListener('click',()=>{
      const view = b.dataset.view; showView(view);
    }));
    function showView(view){ document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden')); document.getElementById('view-'+view).classList.remove('hidden'); renderAll(); }
    // open default
    showView('dashboard');

    /* ---------------------- Leads (List & Kanban) ---------------------- */
    const leadsKey = STORAGE_KEYS.leads;
    function getLeads(){ return loadData(leadsKey); }
    function saveLeads(arr){ saveData(leadsKey, arr); }

    // Render list
    function renderLeadsList(filter=''){
      const list = document.getElementById('leadsList'); list.innerHTML='';
      const data = getLeads().filter(l => (l.name+ (l.whatsapp||'') + (l.origin||'')).toLowerCase().includes(filter.toLowerCase()));
      data.forEach(l => {
        const div = document.createElement('div'); div.className='p-3 rounded bg-black/20 flex items-center justify-between kanban-card';
        div.innerHTML = `<div><div class=\"font-semibold\">${l.name}</div><div class=\"text-xs text-white/60\">${l.whatsapp} ¬∑ ${l.origin} ¬∑ <span class=\"capitalize\">${l.qualification}</span></div></div>
          <div class=\"flex gap-2\"><button data-id=\"${l.id}\" class=\"open-chat-btn px-2 py-1 border rounded text-sm\">Whats</button><button data-id=\"${l.id}\" class=\"edit-lead-btn px-2 py-1 border rounded text-sm\">Editar</button></div>`;
        list.appendChild(div);
      });
      // attach events
      document.querySelectorAll('.open-chat-btn').forEach(b=>b.addEventListener('click',e=>{
        const id = e.currentTarget.dataset.id; const lead = getLeads().find(x=>x.id===id);
        if(lead) window.open(`https://wa.me/${lead.whatsapp.replace(/\D/g,'')}`,'_blank');
      }));
      document.querySelectorAll('.edit-lead-btn').forEach(b=>b.addEventListener('click',e=>{
        const id = e.currentTarget.dataset.id; openLeadModal(id);
      }));
    }

    // Kanban columns
    const KANBAN_COLUMNS = [
      { id:'novo', title:'Novo' }, { id:'em-contato', title:'Em contato' }, { id:'negociacao', title:'Negocia√ß√£o' }, { id:'fechado', title:'Fechado' }, { id:'perdido', title:'Perdido' }
    ];

    function renderKanban(){
      const board = document.getElementById('kanbanBoard'); board.innerHTML='';
      const leads = getLeads();
      KANBAN_COLUMNS.forEach(col => {
        const colEl = document.createElement('div'); colEl.className='w-[320px] bg-black/20 rounded p-3 flex-shrink-0';
        colEl.innerHTML = `<h4 class='font-semibold mb-2'>${col.title}</h4><div id='col-${col.id}' data-status='${col.id}' class='space-y-2 min-h-[120px]'></div>`;
        board.appendChild(colEl);
        const container = colEl.querySelector(`#col-${col.id}`);
        leads.filter(l=>l.status===col.id).forEach(l=>{
          const card = document.createElement('div'); card.className='p-3 rounded bg-[#071022] kanban-card'; card.dataset.id = l.id;
          card.innerHTML = `<div class='font-semibold'>${l.name}</div><div class='text-xs text-white/60'>${l.whatsapp} ¬∑ ${l.origin}</div>`;
          card.addEventListener('click', ()=> openLeadModal(l.id));
          container.appendChild(card);
        });
      });
      // Init Sortable for each column
      KANBAN_COLUMNS.forEach(col=>{
        const el = document.getElementById('col-'+col.id);
        Sortable.create(el, {
          group: 'kanban', animation:150,
          onAdd: function (evt){
            const cardId = evt.item.dataset.id; const newStatus = evt.to.dataset.status; updateLeadStatus(cardId, newStatus);
          }
        });
      });
    }

    function updateLeadStatus(id, status){ const leads = getLeads(); const i = leads.findIndex(l=>l.id===id); if(i>=0){ leads[i].status = status; leads[i].updatedAt = new Date().toISOString(); saveLeads(leads); renderAll(); } }

    /* ---------------------- Modal lead ---------------------- */
    let editingId = null;
    document.getElementById('newLeadBtn').addEventListener('click', ()=> openLeadModal());
    function openLeadModal(id=null){ editingId = id; document.getElementById('modal').classList.remove('hidden'); if(id){ const l = getLeads().find(x=>x.id===id); document.getElementById('modalTitle').innerText='Editar Lead'; document.getElementById('leadName').value=l.name; document.getElementById('leadWhats').value=l.whatsapp; document.getElementById('leadOrigin').value=l.origin; document.getElementById('leadQual').value=l.qualification; document.getElementById('leadDesc').value=l.description; } else { document.getElementById('modalTitle').innerText='Novo Lead'; document.getElementById('leadName').value=''; document.getElementById('leadWhats').value=''; document.getElementById('leadOrigin').value=''; document.getElementById('leadQual').value='quente'; document.getElementById('leadDesc').value=''; }
    }
    document.getElementById('closeModalBtn').addEventListener('click', ()=> document.getElementById('modal').classList.add('hidden'));
    document.getElementById('saveLeadBtn').addEventListener('click', ()=>{
      const name = document.getElementById('leadName').value.trim(); const whats = document.getElementById('leadWhats').value.replace(/\D/g,'');
      if(!name || !whats){ alert('Nome e WhatsApp s√£o obrigat√≥rios'); return; }
      const origin = document.getElementById('leadOrigin').value.trim(); const qual = document.getElementById('leadQual').value; const desc = document.getElementById('leadDesc').value.trim();
      const leads = getLeads();
      if(editingId){ const i = leads.findIndex(l=>l.id===editingId); if(i>=0){ leads[i] = {...leads[i], name, whatsapp:whats, origin, qualification:qual, description:desc, updatedAt: new Date().toISOString()}; } }
      else { leads.push({ id: genId(), name, whatsapp: whats, origin, qualification: qual, description: desc, status: 'novo', createdAt: new Date().toISOString() }); }
      saveLeads(leads); document.getElementById('modal').classList.add('hidden'); renderAll();
    });

    /* ---------------------- Import / Export ---------------------- */
    document.getElementById('importXlsxBtn').addEventListener('click', ()=>{
      const f = document.getElementById('xlsxFile').files[0]; if(!f){ alert('Selecione um arquivo .xlsx'); return; }
      const reader = new FileReader(); reader.onload = (e) => {
        const data = new Uint8Array(e.target.result); const wb = XLSX.read(data, {type:'array'});
        const sheet = wb.SheetNames[0]; const json = XLSX.utils.sheet_to_json(wb.Sheets[sheet]);
        // mapear: Nome, WhatsApp, Origin, Qualification, Description, Status
        const leads = getLeads(); json.forEach(row => {
          const name = row['Nome'] || row['Name'] || row['nome'] || row['name'];
          if(!name) return;
          const whats = String(row['WhatsApp']||row['Whatsapp']||row['whatsapp']||'').replace(/\D/g,'');
          const origin = row['Origem'] || row['Origin'] || '';
          const qual = (row['Qualificacao']||row['Qualification']||'frio').toLowerCase();
          const desc = row['Descricao'] || row['Description'] || '';
          leads.push({ id: genId(), name, whatsapp: whats, origin, qualification: qual, description: desc, status: row['Status']||'novo', createdAt: new Date().toISOString() });
        });
        saveLeads(leads); alert('Importa√ß√£o conclu√≠da'); renderAll();
      };
      reader.readAsArrayBuffer(f);
    });

    document.getElementById('exportCsvBtn').addEventListener('click', ()=>{
      const from = document.getElementById('expFrom').value; const to = document.getElementById('expTo').value;
      let data = getLeads(); if(from) data = data.filter(d => new Date(d.createdAt) >= new Date(from)); if(to) data = data.filter(d => new Date(d.createdAt) <= new Date(to+'T23:59:59'));
      const rows = data.map(d=>({name:d.name, whatsapp:d.whatsapp, origin:d.origin, qual:d.qualification, status:d.status, createdAt:d.createdAt}));
      const csv = [Object.keys(rows[0]||{}).join(','), ...rows.map(r=>Object.values(r).map(v=>`"${String(v).replace(/"/g,'""')}"`).join(','))].join('\n');
      const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='contacts_export.csv'; a.click(); URL.revokeObjectURL(url);
    });

    /* ---------------------- Caixa (simples) ---------------------- */
    const cashKey = STORAGE_KEYS.cash;
    function getCash(){ return loadData(cashKey); }
    function saveCash(arr){ saveData(cashKey, arr); }
    document.getElementById('newCashBtn').addEventListener('click', ()=>{
      const desc = prompt('Descri√ß√£o:'); if(!desc) return; const val = prompt('Valor (use ponto):'); if(!val) return; const type = confirm('Ok = Entrada / Cancelar = Sa√≠da')? 'entrada' : 'saida';
      const entries = getCash(); entries.push({id:genId(), date: new Date().toISOString(), description: desc, amount: Number(val), type}); saveCash(entries); renderCash();
    });
    function renderCash(){ const container = document.getElementById('cashList'); const entries = getCash(); let html = '<table class="w-full text-sm"><thead><tr><th>Data</th><th>Tipo</th><th>Descri√ß√£o</th><th class="text-right">Valor</th></tr></thead><tbody>'; let balance = 0; entries.forEach(e=>{ html+=`<tr class="border-t border-white/5"><td>${new Date(e.date).toLocaleString()}</td><td class=\"capitalize\">${e.type}</td><td>${e.description}</td><td class=\"text-right\">${fmtMoney(e.amount)}</td></tr>`; balance += e.type==='entrada'? Number(e.amount): -Number(e.amount); }); html += `</tbody></table><div class=\"mt-3 text-right font-bold\">Saldo: ${fmtMoney(balance)}</div>`; container.innerHTML = html; document.getElementById('statCash').innerText = fmtMoney(balance); }

    /* ---------------------- Produtos (simples) ---------------------- */
    const prodKey = STORAGE_KEYS.products;
    function getProducts(){ return loadData(prodKey); }
    function saveProducts(arr){ saveData(prodKey, arr); }
    document.getElementById('newProductBtn').addEventListener('click', ()=>{
      const name = prompt('Nome do produto:'); if(!name) return; const cost = prompt('Custo (use ponto):'); const price = prompt('Pre√ßo de venda:'); const stock = prompt('Estoque inicial:');
      const prods = getProducts(); prods.push({id:genId(), name, cost: Number(cost), price: Number(price), stock: Number(stock)}); saveProducts(prods); renderProducts();
    });
    function renderProducts(){ const container = document.getElementById('productsList'); const prods = getProducts(); container.innerHTML = ''; let totalStock=0; prods.forEach(p=>{ totalStock += p.stock || 0; const el = document.createElement('div'); el.className='p-3 rounded bg-black/20'; el.innerHTML = `<div class=\"font-semibold\">${p.name}</div><div class=\"text-xs text-white/60\">Custo: ${fmtMoney(p.cost)} ¬∑ Pre√ßo: ${fmtMoney(p.price)} ¬∑ Estoque: ${p.stock}</div>`; container.appendChild(el); }); document.getElementById('statStock').innerText = totalStock; }

    /* ---------------------- Mentoria (placeholder) ---------------------- */
    const mentKey = STORAGE_KEYS.mentorship;
    function getMent(){ return loadData(mentKey); }
    function saveMent(arr){ saveData(mentKey, arr); }
    // Exemplo: render vazio at√© voc√™ enviar o doc Word (pr√≥ximo passo)
    function renderMentoria(){ const c = document.getElementById('mentoriaModules'); const modules = getMent(); if(!modules.length) { c.innerHTML = '<div class="p-3 bg-black/20 rounded">Nenhum m√≥dulo importado ainda. Envie o arquivo Word e eu importo.</div>'; return; } c.innerHTML = ''; modules.forEach(m=>{ const el = document.createElement('div'); el.className='p-3 bg-black/20 rounded'; el.innerHTML = `<div class=\"font-semibold\">${m.title}</div><div class=\"text-sm text-white/60\">${m.content.slice(0,200)}...</div>`; c.appendChild(el); }); }

    /* ---------------------- Chatbot mock (front) ---------------------- */
    document.getElementById('openChatBtn').addEventListener('click', ()=> document.getElementById('chatDrawer').classList.remove('hidden'));
    document.getElementById('closeChat').addEventListener('click', ()=> document.getElementById('chatDrawer').classList.add('hidden'));
    document.getElementById('sendChat').addEventListener('click', async ()=>{
      const txt = document.getElementById('chatInput').value.trim(); if(!txt) return; appendBotMessage('Voc√™: '+txt); document.getElementById('chatInput').value='';
      // Mock response ‚Äî aqui vamos integrar ao backend/Gemini depois. Salve mem√≥ria no Firestore/Storage.
      appendBotMessage('Bot: Recebi sua mensagem ‚Äî (mock). Integra√ß√£o com Gemini ser√° feita via backend.');
    });
    function appendBotMessage(t){ const box = document.getElementById('chatMessages'); const p = document.createElement('div'); p.className='mb-2 text-sm'; p.innerText = t; box.appendChild(p); box.scrollTop = box.scrollHeight; }

    /* ---------------------- Logo upload preview (localStorage) ---------------------- */
    document.getElementById('uploadLogoBtn').addEventListener('click', ()=> document.getElementById('logoInput').click());
    document.getElementById('logoInput').addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = () => { localStorage.setItem(STORAGE_KEYS.logo, reader.result); document.getElementById('logoPreview').innerHTML = `<img src=\"${reader.result}\" alt=\"logo\" class=\"w-full h-full object-contain rounded\" />`; };
      reader.readAsDataURL(f);
    });
    // load logo if exists
    const logoData = localStorage.getItem(STORAGE_KEYS.logo); if(logoData) document.getElementById('logoPreview').innerHTML = `<img src="${logoData}" alt="logo" class="w-full h-full object-contain rounded" />`;

    /* ---------------------- Small UI bindings ---------------------- */
    document.getElementById('filterSearch').addEventListener('input',(e)=> renderLeadsList(e.target.value));
    document.getElementById('xlsxFile').addEventListener('change', ()=>{});

    /* ---------------------- Render helper ---------------------- */
    function renderAll(){ renderLeadsList(document.getElementById('filterSearch').value||''); renderKanban(); renderCash(); renderProducts(); renderMentoria(); renderStats(); }

    function renderStats(){ const leads = getLeads(); document.getElementById('statTotalLeads').innerText = leads.length; document.getElementById('statHot').innerText = leads.filter(l=>l.qualification==='quente').length; }

    // Start
    renderAll();

    /* ---------------------- Where to plug Firebase / Gemini ----------------------
      - Quando quiser adicionar Firebase: substituir chamadas a localStorage por Firestore SDK.
      - Crie um arquivo /cloud-function/backend.js que receba mensagens do frontend e chame a API Gemini (chave no Secret Manager). O backend deve: 1) buscar mem√≥ria do lead, 2) enviar prompt+mem√≥ria ao Gemini, 3) retornar resposta ao frontend e salvar resumo no DB.
      - Marque aqui os pontos: function sendToBotBackend(message, leadId) { /* fetch('/api/bot', {method:'POST', body: JSON.stringify({message, leadId})}) */ }
    ---------------------- */

  </script>
</body>
</html>
